{"version":3,"file":"index.modern.js","sources":["../src/context/state.ts","../src/context/reducer.ts","../src/context/index.tsx","../src/components/bussniess/Viewer/hooks.ts","../src/components/bussniess/Viewer/index.tsx","../src/components/common/Tooltip/index.tsx","../src/components/bussniess/Controller/hooks.ts","../src/components/bussniess/Controller/index.tsx","../src/components/common/ScaleTip/index.tsx","../src/components/bussniess/Browser/index.tsx","../src/components/bussniess/PictureViewer/index.tsx"],"sourcesContent":["import { IPicture } from '@/components/bussniess/PictureViewer/interface'\n\nexport interface IState {\n  layerShown: boolean\n  picturesList: IPicture[]\n  imgScale: number\n}\n\nexport const initialState = (picturesList: IPicture[]): IState => ({\n  picturesList,\n  layerShown: false,\n  imgScale: 1\n})\n","import { IState } from './state'\nimport { IAction } from './action'\n\nfunction reducer(state: IState, action: IAction): IState {\n  switch (action.type) {\n    case 'SHOWN_LAYER': {\n      const returnState = { ...state, layerShown: action.visible }\n      if (!action.visible) returnState.imgScale = 1\n      return returnState\n    }\n\n    case 'SET_SCALE': {\n      return { ...state, imgScale: action.scale }\n    }\n\n    default:\n      return state\n  }\n}\n\nexport default reducer\n","import React, { createContext, useReducer, Dispatch, useContext } from 'react'\nimport { initialState, IState } from './state'\nimport { IAction } from './action'\nimport reducer from './reducer'\nimport { IPicture } from '@/components/bussniess/PictureViewer/interface'\n\ninterface IContext extends IState {\n  dispatch: Dispatch<IAction>\n}\nconst Context = createContext(null as IContext | null)\n\ninterface Props {\n  picturesList: IPicture[]\n}\n\nconst ContextProvider: React.FC<Props> = ({ children, picturesList }) => {\n  const [state, dispatch] = useReducer(reducer, initialState(picturesList))\n\n  return (\n    <Context.Provider value={{ dispatch, ...state }}>\n      {children}\n    </Context.Provider>\n  )\n}\n\nexport function useStore() {\n  const store = useContext(Context)\n  if (!store) {\n    throw new Error('store is Empty')\n  }\n\n  return store\n}\n\nexport default ContextProvider\n","import { useEffect, useState, useCallback, useMemo, MouseEvent } from 'react'\nimport { useStore } from '@/context'\n\nconst floor = (num: number) => Math.floor(num)\nconst abs = (num: number) => Math.abs(num)\n\nexport function useWindowSize() {\n  const [windowWidth, setWindowWidth] = useState(document.body.clientWidth)\n  const [windowHeight, setWindowHeight] = useState(document.body.clientHeight)\n\n  const setSize = useCallback(() => {\n    setWindowWidth(document.body.clientWidth)\n    setWindowHeight(document.body.clientHeight)\n  }, [])\n\n  useEffect(() => {\n    window.addEventListener('resize', setSize)\n    return () => {\n      window.removeEventListener('resize', setSize)\n    }\n  }, [])\n\n  return { windowWidth, windowHeight }\n}\n\nexport function useImgSize(fn: () => HTMLImageElement | null) {\n  const { imgScale } = useStore()\n  const [imgWidth, setImgWidth] = useState(0)\n  const [imgHeight, setImgHeight] = useState(0)\n\n  useEffect(() => {\n    const ele = fn()\n    if (!ele) return\n    setImgWidth(ele.clientWidth * imgScale)\n    setImgHeight(ele.clientHeight * imgScale)\n  }, [fn])\n\n  return { imgWidth, imgHeight }\n}\n\nexport function useDragInfo() {\n  const { windowWidth, windowHeight } = useWindowSize()\n  const { imgWidth, imgHeight } = useImgSize(() =>\n    document.querySelector<HTMLImageElement>('#viewerImg')\n  )\n\n  const isCanDrag = useMemo(\n    () => imgWidth > windowWidth || imgHeight > windowHeight,\n    [imgWidth, imgHeight, windowWidth, windowHeight]\n  )\n\n  return { isCanDrag, windowWidth, windowHeight, imgWidth, imgHeight }\n}\n\nexport function useMove() {\n  const { imgScale } = useStore()\n  const [dragStatus, setDragStatus] = useState(false)\n  const [lastReacordPos, setLastRecordPos] = useState({ x: 0, y: 0 })\n  const [startPos, setStartPos] = useState({ x: 0, y: 0 })\n  const [offsetPos, setOffsetPos] = useState({ x: 0, y: 0 })\n  const {\n    isCanDrag,\n    windowWidth,\n    imgWidth,\n    windowHeight,\n    imgHeight\n  } = useDragInfo()\n\n  useEffect(() => {\n    if (isCanDrag) return\n    setStartPos({ x: 0, y: 0 })\n    setOffsetPos({ x: 0, y: 0 })\n    setLastRecordPos({ x: 0, y: 0 })\n  }, [imgScale, isCanDrag])\n\n  const onStartMove = useCallback(\n    (e: MouseEvent<HTMLImageElement>) => {\n      e.preventDefault()\n      if (!isCanDrag) return\n      setDragStatus(true)\n      setStartPos({ x: e.clientX, y: e.clientY })\n    },\n    [isCanDrag]\n  )\n\n  const onMoving = useCallback(\n    (e: MouseEvent<HTMLImageElement>) => {\n      e.persist()\n      if (!isCanDrag || !dragStatus) return\n\n      const newPosX = startPos.x - e.clientX + lastReacordPos.x\n      const newPosY = startPos.y - e.clientY + lastReacordPos.y\n\n      if (imgWidth > windowWidth || imgHeight > windowHeight) {\n        if (abs(floor(newPosX)) < floor((imgWidth - windowWidth) / 2)) {\n          setOffsetPos((pos) => ({\n            ...pos,\n            x: newPosX\n          }))\n        }\n\n        if (abs(floor(newPosY)) < floor((imgHeight - windowHeight) / 2)) {\n          setOffsetPos((pos) => ({\n            ...pos,\n            y: newPosY\n          }))\n        }\n      }\n    },\n    [\n      isCanDrag,\n      dragStatus,\n      startPos,\n      lastReacordPos,\n      imgWidth,\n      imgHeight,\n      windowWidth,\n      windowHeight\n    ]\n  )\n\n  const onEndMove = useCallback(\n    (e: MouseEvent<HTMLImageElement>) => {\n      e.preventDefault()\n      if (dragStatus === false) return\n      setDragStatus(false)\n      setLastRecordPos({ x: offsetPos.x, y: offsetPos.y })\n    },\n    [isCanDrag, dragStatus, offsetPos]\n  )\n\n  return { onStartMove, onMoving, onEndMove, offsetPos, dragStatus }\n}\n","import React, { memo } from 'react'\nimport { useStore } from '@/context'\nimport { useDragInfo, useMove } from './hooks'\nimport styles from './style.module.scss'\n\ninterface Props {\n  currentOrder: number\n}\n\nconst Viewer: React.FC<Props> = ({ currentOrder }) => {\n  const { picturesList, imgScale } = useStore()\n  const { isCanDrag } = useDragInfo()\n  const { onStartMove, onMoving, onEndMove, offsetPos, dragStatus } = useMove()\n\n  return (\n    <div\n      className={styles.imgWrapper}\n      onMouseUp={onEndMove}\n      onMouseLeave={onEndMove}\n    >\n      <div className={styles.container}>\n        <img\n          id=\"viewerImg\"\n          draggable\n          style={{\n            transform: `translate(${-offsetPos.x}px, ${-offsetPos.y}px) scale(${imgScale})`,\n            transition: dragStatus ? `none` : 'transform 0.3s ease-in-out',\n            cursor: isCanDrag ? 'grab' : 'inherit'\n          }}\n          src={picturesList[currentOrder].src}\n          alt={picturesList[currentOrder].alt}\n          onMouseDown={onStartMove}\n          onMouseMove={onMoving}\n        />\n      </div>\n    </div>\n  )\n}\n\nexport default memo(Viewer)\n","import React, { memo } from 'react'\nimport styles from './styles.module.scss'\n\ninterface Props {\n  content: React.ReactNode\n  children: React.ReactNode\n}\n\nconst Tooltip: React.FC<Props> = ({ content, children }) => {\n  return (\n    <div className={styles.tooltip}>\n      {children}\n\n      <span className={styles.tooltipContent}>{content}</span>\n    </div>\n  )\n}\n\nexport default memo(Tooltip)\n","import { useEffect, useCallback, useState } from 'react'\nimport { useStore } from '@/context'\n\nexport function useKeyboardClose(usingStatus: boolean, onClose: () => void) {\n  const listenEnterToClose = useCallback(\n    (e: KeyboardEvent) => {\n      if (e.code !== 'Escape') return\n      e.preventDefault()\n      onClose()\n    },\n    [onClose]\n  )\n\n  useEffect(() => {\n    if (!usingStatus) return\n    document.addEventListener('keyup', listenEnterToClose)\n    return () => {\n      document.removeEventListener('keyup', listenEnterToClose)\n    }\n  }, [])\n}\n\nexport function useIntoViewerShown() {\n  const { layerShown } = useStore()\n  const [controllerShown, setControllerShown] = useState(true)\n\n  useEffect(() => {\n    if (!layerShown) return\n    setTimeout(() => {\n      setControllerShown(false)\n    }, 2000)\n  }, [layerShown])\n\n  return controllerShown\n}\n\nexport function useScaleFn() {\n  const { dispatch, imgScale } = useStore()\n  const zoomin = useCallback(() => {\n    if (imgScale >= 5) return\n    dispatch({ type: 'SET_SCALE', scale: imgScale + 0.25 })\n  }, [imgScale])\n\n  const zoomout = useCallback(() => {\n    if (imgScale <= 0.25) return\n    dispatch({ type: 'SET_SCALE', scale: imgScale - 0.25 })\n  }, [imgScale])\n\n  return { zoomin, zoomout }\n}\n","import React, { memo } from 'react'\nimport Tooltip from '@/components/common/Tooltip'\nimport { useStore } from '@/context'\nimport { useKeyboardClose, useIntoViewerShown, useScaleFn } from './hooks'\nimport styles from './styles.module.scss'\n\ninterface Props {\n  keyboard: boolean\n  onClose(): void\n}\n\nconst Controller: React.FC<Props> = ({ onClose, keyboard }) => {\n  const { dispatch } = useStore()\n  useKeyboardClose(keyboard, onClose)\n  const controllerShown = useIntoViewerShown()\n  const { zoomin, zoomout } = useScaleFn()\n\n  return (\n    <div className={styles.container}>\n      <div className={styles.top}>\n        <div\n          className={styles.close}\n          onClick={() => dispatch({ type: 'SHOWN_LAYER', visible: false })}\n        >\n          <i className=\"iconfont icon-close\" />\n        </div>\n      </div>\n\n      <div\n        className={styles.bottom + (controllerShown ? ` ${styles.shown}` : '')}\n      >\n        <div className={styles.controller}>\n          <Tooltip content=\"上一张\">\n            <div className={styles.controllerItem} onClick={zoomin}>\n              <i\n                className=\"iconfont icon-arrow\"\n                style={{ transform: 'rotate(180deg)' }}\n              />\n            </div>\n          </Tooltip>\n\n          <Tooltip content=\"下一张\">\n            <div className={styles.controllerItem} onClick={zoomin}>\n              <i className=\"iconfont icon-arrow\" />\n            </div>\n          </Tooltip>\n\n          <span className={styles.separator} />\n\n          <Tooltip content=\"放大\">\n            <div className={styles.controllerItem} onClick={zoomin}>\n              <i className=\"iconfont icon-zoomin\" />\n            </div>\n          </Tooltip>\n\n          <Tooltip content=\"缩小\">\n            <div className={styles.controllerItem} onClick={zoomout}>\n              <i className=\"iconfont icon-zoomout\" />\n            </div>\n          </Tooltip>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default memo(Controller)\n","import React, { memo, useState, useEffect } from 'react'\nimport { useStore } from '@/context'\nimport styles from './style.module.scss'\n\nlet timeout: NodeJS.Timeout | null = null\n\nconst ScaleTip: React.FC = () => {\n  const { imgScale } = useStore()\n  const [shown, setShown] = useState(false)\n\n  useEffect(() => {\n    if (timeout) {\n      if (!shown) setShown(true)\n      clearTimeout(timeout)\n    }\n    timeout = setTimeout(() => {\n      setShown(false)\n    }, 1000)\n  }, [imgScale])\n\n  return (\n    <div\n      className={styles.tooltip}\n      style={{\n        opacity: shown ? 1 : 0,\n        visibility: shown ? 'visible' : 'hidden'\n      }}\n    >\n      {imgScale * 100}%\n    </div>\n  )\n}\n\nexport default memo(ScaleTip)\n","import React, { Fragment, memo } from 'react'\nimport { useStore } from '@/context'\nimport { Portal } from 'react-portal'\nimport Viewer from '../Viewer'\nimport Controller from '../Controller'\nimport ScaleTip from '@/components/common/ScaleTip'\nimport { Props } from './interface.d'\nimport styles from './styles.module.scss'\n\nconst Browser: React.FC<Props> = (props) => {\n  const { keyboard, currentOrder } = props\n  const { layerShown, dispatch } = useStore()\n\n  return (\n    <Fragment>\n      {layerShown && (\n        <Portal>\n          <div className={styles.wrapperLayer}>\n            <Viewer currentOrder={currentOrder} />\n\n            <Controller\n              keyboard={keyboard}\n              onClose={() => dispatch({ type: 'SHOWN_LAYER', visible: false })}\n            />\n\n            <ScaleTip />\n          </div>\n        </Portal>\n      )}\n    </Fragment>\n  )\n}\n\nexport default memo(Browser)\n","import React, { useMemo, Fragment, memo } from 'react'\nimport ContextProvider, { useStore } from '@/context'\nimport Browser from '@/components/bussniess/Browser'\nimport { Props, IPicture } from './interface'\n\ninterface ImgProps {\n  style?: React.CSSProperties\n  className?: string\n  firstImg: IPicture\n}\nconst ImgViewer: React.FC<ImgProps> = memo((props) => {\n  const { style, className, firstImg } = props\n  const { dispatch } = useStore()\n  return (\n    <img\n      className={className}\n      style={{ cursor: 'zoom-in', ...style }}\n      src={firstImg.src}\n      alt={firstImg.alt}\n      onClick={() => dispatch({ type: 'SHOWN_LAYER', visible: true })}\n    />\n  )\n})\n\nconst PictureViewer: React.FC<Props> = (props) => {\n  const {\n    className,\n    style,\n    picture,\n    zIndex = 1000,\n    keyboard = true,\n    currentOrder = 0\n  } = props\n\n  const firstImg = useMemo<IPicture>(\n    () => (Array.isArray(picture) ? picture[0] : picture),\n    [picture]\n  )\n\n  const picturesList = useMemo<IPicture[]>(\n    () => (Array.isArray(picture) ? picture : [picture]),\n    [picture]\n  )\n\n  return (\n    <ContextProvider picturesList={picturesList}>\n      <Fragment>\n        <ImgViewer firstImg={firstImg} style={style} className={className} />\n\n        <Browser\n          zIndex={zIndex}\n          keyboard={keyboard}\n          currentOrder={currentOrder}\n        />\n      </Fragment>\n    </ContextProvider>\n  )\n}\n\nexport default PictureViewer\n"],"names":["initialState","picturesList","layerShown","imgScale","reducer","state","action","type","returnState","visible","scale","Context","createContext","ContextProvider","children","useReducer","dispatch","React","Provider","value","useStore","store","useContext","Error","floor","num","Math","abs","useWindowSize","useState","document","body","clientWidth","windowWidth","setWindowWidth","clientHeight","windowHeight","setWindowHeight","setSize","useCallback","useEffect","window","addEventListener","removeEventListener","useImgSize","fn","imgWidth","setImgWidth","imgHeight","setImgHeight","ele","useDragInfo","querySelector","isCanDrag","useMemo","useMove","dragStatus","setDragStatus","x","y","lastReacordPos","setLastRecordPos","startPos","setStartPos","offsetPos","setOffsetPos","onStartMove","e","preventDefault","clientX","clientY","onMoving","persist","newPosX","newPosY","pos","onEndMove","Viewer","currentOrder","className","styles","imgWrapper","onMouseUp","onMouseLeave","container","id","draggable","style","transform","transition","cursor","src","alt","onMouseDown","onMouseMove","memo","Tooltip","content","tooltip","tooltipContent","useKeyboardClose","usingStatus","onClose","listenEnterToClose","code","useIntoViewerShown","controllerShown","setControllerShown","setTimeout","useScaleFn","zoomin","zoomout","Controller","keyboard","top","close","onClick","bottom","shown","controller","controllerItem","separator","timeout","ScaleTip","setShown","clearTimeout","opacity","visibility","Browser","props","Fragment","Portal","wrapperLayer","ImgViewer","firstImg","PictureViewer","picture","zIndex","Array","isArray"],"mappings":"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"}